!!! 5
%html
	%head
		%title Sneaker-Bot
		:css
			body, td { font-family: Verdana, Helvetica, Arial, sans-serif; }
			td { border: 1px dotted #aaa; }
			th { border-bottom: 1px solid #aaa; }
			section { display: inline-block; width: 49%; }
			h2 { margin-bottom: 5px; }

	%body
		%h1 Sneak am #{@sneak.time.strftime "%d.%m.%Y"}
		%strong Bonus-Punkte für diese Sneak:
		= @sneak.bonus_points

		%br/
		%br/
		
		%section
			%h2 Anmeldungen
			%table
				%tr
					%th Name
					%th Anzahl
					%th PSP
					%th Bonus
					%th Freikarte

				- @sneak.participations.all(:active=>true).each do |p|
					%tr
						%td= p.user.alias || p.user.username
						%td= p.sum
						%td= p.psp ? "X" : "-"
						%td= p.user.bonus_points>=5 ? "X" : "-"
						%td= p.frei ? "X" : "-"
        
		%section
			%h2 Aktueller (!) Bonuspunktestand
			%table
				%tr
					%th Name
					%th Anzahl Stempel

				- User.all.each do |u|
					%tr
						%td= u.alias || u.username
						%td= u.bonus_points
		
		%section
			%h2 Bezahlung
			%table
				%tr
					%th Bezahlen
					%th Bonuskarten

				%tr
					%td= @sneak.participations.all(:active=>true, :sum.gt=>0).collect(&:user).select{|u| u.bonus_points<5}.collect{|u| u.alias||u.username}.join("<br />")
					%td= @sneak.participations.all(:active=>true, :sum.gt=>0).collect(&:user).select{|u| u.bonus_points>4}.collect{|u| u.alias||u.username}.join("<br />")

		%section
			%h2 Bonuskarten
			%table
				%tr
					%th Ganz neu
					%th Auffüllen
					%th Halb und halb
				
				%tr
					%td= @sneak.participations.all(:active=>true, :sum.gt=>0).collect(&:user).select{|u| (u.bonus_points%5)==0}.collect{|u| u.alias||u.username}.join("<br />")
					%td= @sneak.participations.all(:active=>true, :sum.gt=>0).collect(&:user).select{|u| u.bonus_points%5>0 && (u.bonus_points%5)+Sneak.newest.bonus_points<=5}.collect{|u| u.alias||u.username}.join("<br />")
					%td= @sneak.participations.all(:active=>true, :sum.gt=>0).collect(&:user).select{|u| u.bonus_points%5>0 && (u.bonus_points%5)+Sneak.newest.bonus_points>5}.collect{|u| u.alias||u.username}.join("<br />")

